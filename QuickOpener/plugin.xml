<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
    <plugin>

        <!-- declaration of category and commands -->
        <extension point="org.eclipse.ui.commands">
            <category name="QuickOpener"
                id="QuickOpener.commands.category">
            </category>
            <command  name="Terminal"
                categoryId="QuickOpener.commands.category"
                id="QuickOpener.commands.terminal">
            </command>
            <command  name="FileSystem"
                categoryId="QuickOpener.commands.category"
                id="QuickOpener.commands.filesystem">
            </command>
            <command  name="Path"
                categoryId="QuickOpener.commands.category"
                id="QuickOpener.commands.path">
            </command>
        </extension>
      
        <!-- source providers -->
        <extension point="org.eclipse.ui.services">
            <sourceProvider provider="com.sessonad.quickopener.statusmanagement.PluginSourceProvider">
                <variable 
                    name="quickopener.active"
                    priorityLevel="workbench">
                </variable>
            </sourceProvider>
        </extension>
      
        <!-- handlers definitions-->
        <extension point="org.eclipse.core.expressions.definitions">
            <definition id="QuickOpener.commands.activeSelection">
                <with variable="quickopener.active">
                    <equals value="yes"/>
                </with>
            </definition>
            <definition id="QuickOpener.commands.ResourceNavigator">
                <with variable="activePartId">
                    <equals value="org.eclipse.ui.views.ResourceNavigator"/>
                </with>
            </definition>
            <definition id="QuickOpener.commands.ProjectExplorer">
                <with variable="activePartId">
                    <equals value="org.eclipse.ui.navigator.ProjectExplorer"/>
                </with>
            </definition>
            <definition id="QuickOpener.commands.PackageExplorer">
                <with variable="activePartId">
                    <equals value="org.eclipse.jdt.ui.PackageExplorer"/>
                </with>
            </definition>
            <definition id="QuickOpener.commands.CompilationUnitEditor">
                <with variable="activePartId">
                    <equals value="org.eclipse.jdt.ui.CompilationUnitEditor"/>
                </with>
            </definition>
            <definition id="QuickOpener.commands.Editor">
                <with variable="activeEditorId">
                    <not>
                        <equals value="null"/>
                    </not>
                </with>
            </definition>
        </extension>
   
        <!-- handlers -->
        <extension point="org.eclipse.ui.handlers">
            <handler commandId="QuickOpener.commands.terminal" 	class="com.sessonad.quickopener.handlers.TerminalHandler">
                <activeWhen>      		
                    <and>
                        <reference definitionId="QuickOpener.commands.activeSelection"/>
                        <or>
                            <reference definitionId="QuickOpener.commands.ProjectExplorer"/>
                            <reference definitionId="QuickOpener.commands.ResourceNavigator"/>
                            <reference definitionId="QuickOpener.commands.PackageExplorer"/> 
                            <reference definitionId="QuickOpener.commands.Editor"/>     		
                        </or>
                    </and>      		
                </activeWhen>      		
            </handler>
            <handler commandId="QuickOpener.commands.filesystem"  class="com.sessonad.quickopener.handlers.FileSystemHandler">
                <activeWhen>      		
                    <and>
                        <reference definitionId="QuickOpener.commands.activeSelection"/>
                        <or>
                            <reference definitionId="QuickOpener.commands.ProjectExplorer"/>
                            <reference definitionId="QuickOpener.commands.ResourceNavigator"/>
                            <reference definitionId="QuickOpener.commands.PackageExplorer"/> 
                            <reference definitionId="QuickOpener.commands.Editor"/>     		
                        </or>
                    </and>      		
                </activeWhen> 
            </handler>
            <handler commandId="QuickOpener.commands.path" 		class="com.sessonad.quickopener.handlers.PathHandler">
                <activeWhen>      		
                    <and>
                        <reference definitionId="QuickOpener.commands.activeSelection"/>
                        <or>
                            <reference definitionId="QuickOpener.commands.ProjectExplorer"/>
                            <reference definitionId="QuickOpener.commands.ResourceNavigator"/>
                            <reference definitionId="QuickOpener.commands.PackageExplorer"/> 
                            <reference definitionId="QuickOpener.commands.Editor"/>     		
                        </or>
                    </and>      		
                </activeWhen>
            </handler>
        </extension>  
    
        <!-- toolbar -->
        <extension point="org.eclipse.ui.menus">      
            <menuContribution locationURI="toolbar:org.eclipse.ui.main.toolbar?after=additions">
                <toolbar id="QuickOpener.toolbars.quickopener">
                    <command commandId="QuickOpener.commands.terminal"
                     icon="icons/terminal.png"
                     tooltip="Open in the default OS shell"
                     id="QuickOpener.toolbars.quickopener.terminal">
                    </command>
                    <command commandId="QuickOpener.commands.filesystem"
                     icon="icons/folder-documents-icon.png"
                     tooltip="Open in the OS file system browser"
                     id="QuickOpener.toolbars.quickopener.filesystem">
                    </command>
                    <command commandId="QuickOpener.commands.path"
                     icon="icons/path.png"
                     tooltip="Copy the path to the clipboard"
                     id="QuickOpener.toolbars.quickopener.path">
                    </command>
                </toolbar>
            </menuContribution>
        </extension>
    </plugin>